{"version":3,"sources":["createFlatTreeItems.js"],"sourcesContent":["import * as React from 'react';\n/**\n * creates a list of flat tree items\n * and provides a map to access each item by id\n */ export function createFlatTreeItems(flatTreeItemProps) {\n    const root = createFlatTreeRootItem();\n    const itemsPerValue = new Map([\n        [\n            root.value,\n            root\n        ]\n    ]);\n    const items = [];\n    for(let index = 0; index < flatTreeItemProps.length; index++){\n        const { parentValue =flatTreeRootId , ...treeItemProps } = flatTreeItemProps[index];\n        const nextItemProps = flatTreeItemProps[index + 1];\n        const currentParent = itemsPerValue.get(parentValue);\n        if (!currentParent) {\n            if (process.env.NODE_ENV === 'development') {\n                // eslint-disable-next-line no-console\n                console.error(`useFlatTree: item ${flatTreeItemProps[index].id} is wrongly positioned, did you properly ordered provided item props? make sure provided items are organized`);\n            }\n            break;\n        }\n        var _treeItemProps_itemType;\n        const itemType = (_treeItemProps_itemType = treeItemProps.itemType) !== null && _treeItemProps_itemType !== void 0 ? _treeItemProps_itemType : treeItemProps.value === undefined || (nextItemProps === null || nextItemProps === void 0 ? void 0 : nextItemProps.parentValue) !== treeItemProps.value ? 'leaf' : 'branch';\n        var _currentParent_level;\n        const currentLevel = ((_currentParent_level = currentParent.level) !== null && _currentParent_level !== void 0 ? _currentParent_level : 0) + 1;\n        const currentChildrenSize = ++currentParent.childrenSize;\n        const ref = React.createRef();\n        const flatTreeItem = {\n            value: treeItemProps.value,\n            getTreeItemProps: ()=>({\n                    ...treeItemProps,\n                    'aria-level': currentLevel,\n                    'aria-posinset': currentChildrenSize,\n                    'aria-setsize': currentParent.childrenSize,\n                    itemType,\n                    // a reference to every parent element is necessary to ensure navigation\n                    ref: flatTreeItem.childrenSize > 0 ? ref : undefined\n                }),\n            ref,\n            level: currentLevel,\n            parentValue,\n            childrenSize: 0,\n            index: -1\n        };\n        itemsPerValue.set(flatTreeItem.value, flatTreeItem);\n        items.push(flatTreeItem);\n    }\n    const flatTreeItems = {\n        root,\n        size: items.length,\n        getByIndex: (index)=>items[index],\n        get: (key)=>itemsPerValue.get(key),\n        set: (key, value)=>itemsPerValue.set(key, value)\n    };\n    return flatTreeItems;\n}\nexport const flatTreeRootId = '__fuiFlatTreeRoot';\nfunction createFlatTreeRootItem() {\n    return {\n        ref: {\n            current: null\n        },\n        value: flatTreeRootId,\n        parentValue: undefined,\n        getTreeItemProps: ()=>{\n            if (process.env.NODE_ENV !== 'production') {\n                // eslint-disable-next-line no-console\n                console.error('useFlatTree: internal error, trying to access treeitem props from invalid root element');\n            }\n            return {\n                value: flatTreeRootId,\n                'aria-setsize': -1,\n                'aria-level': -1,\n                'aria-posinset': -1,\n                itemType: 'branch'\n            };\n        },\n        childrenSize: 0,\n        get index () {\n            if (process.env.NODE_ENV !== 'production') {\n                // eslint-disable-next-line no-console\n                console.error('useFlatTree: internal error, trying to access treeitem props from invalid root element');\n            }\n            return -1;\n        },\n        level: 0\n    };\n}\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport function* VisibleFlatTreeItemGenerator(openItems, flatTreeItems) {\n    for(let index = 0, visibleIndex = 0; index < flatTreeItems.size; index++){\n        const item = flatTreeItems.getByIndex(index);\n        if (isItemVisible(item, openItems, flatTreeItems)) {\n            item.index = visibleIndex++;\n            yield item;\n        } else {\n            // Jump the amount of children the current item has, since those items will also be hidden\n            index += item.childrenSize;\n        }\n    }\n}\nfunction isItemVisible(item, openItems, flatTreeItems) {\n    if (item.level === 1) {\n        return true;\n    }\n    while(item.parentValue && item.parentValue !== flatTreeItems.root.value){\n        if (!openItems.has(item.parentValue)) {\n            return false;\n        }\n        const parent = flatTreeItems.get(item.parentValue);\n        if (!parent) {\n            return false;\n        }\n        item = parent;\n    }\n    return true;\n}\n"],"names":["createFlatTreeItems","flatTreeRootId","VisibleFlatTreeItemGenerator","flatTreeItemProps","root","createFlatTreeRootItem","itemsPerValue","Map","value","items","index","length","parentValue","treeItemProps","nextItemProps","currentParent","get","process","env","NODE_ENV","console","error","id","_treeItemProps_itemType","itemType","undefined","_currentParent_level","currentLevel","level","currentChildrenSize","childrenSize","ref","React","createRef","flatTreeItem","getTreeItemProps","set","push","flatTreeItems","size","getByIndex","key","current","openItems","visibleIndex","item","isItemVisible","has","parent"],"mappings":";;;;;;;;;;;IAIoBA,mBAAmB,MAAnBA;IAuDPC,cAAc,MAAdA;IAiCIC,4BAA4B,MAA5BA;;;6DA5FM;AAIZ,SAASF,oBAAoBG,iBAAiB,EAAE;IACvD,MAAMC,OAAOC;IACb,MAAMC,gBAAgB,IAAIC,IAAI;QAC1B;YACIH,KAAKI,KAAK;YACVJ;SACH;KACJ;IACD,MAAMK,QAAQ,EAAE;IAChB,IAAI,IAAIC,QAAQ,GAAGA,QAAQP,kBAAkBQ,MAAM,EAAED,QAAQ;QACzD,MAAM,EAAEE,aAAaX,eAAc,EAAG,GAAGY,eAAe,GAAGV,iBAAiB,CAACO,MAAM;QACnF,MAAMI,gBAAgBX,iBAAiB,CAACO,QAAQ,EAAE;QAClD,MAAMK,gBAAgBT,cAAcU,GAAG,CAACJ;QACxC,IAAI,CAACG,eAAe;YAChB,IAAIE,QAAQC,GAAG,CAACC,QAAQ,KAAK,eAAe;gBACxC,sCAAsC;gBACtCC,QAAQC,KAAK,CAAC,CAAC,kBAAkB,EAAElB,iBAAiB,CAACO,MAAM,CAACY,EAAE,CAAC,4GAA4G,CAAC;YAChL,CAAC;YACD,KAAM;QACV,CAAC;QACD,IAAIC;QACJ,MAAMC,WAAW,AAACD,CAAAA,0BAA0BV,cAAcW,QAAQ,AAAD,MAAO,IAAI,IAAID,4BAA4B,KAAK,IAAIA,0BAA0BV,cAAcL,KAAK,KAAKiB,aAAa,AAACX,CAAAA,kBAAkB,IAAI,IAAIA,kBAAkB,KAAK,IAAI,KAAK,IAAIA,cAAcF,WAAW,AAAD,MAAOC,cAAcL,KAAK,GAAG,SAAS,QAAQ;QACzT,IAAIkB;QACJ,MAAMC,eAAe,AAAC,CAAA,AAACD,CAAAA,uBAAuBX,cAAca,KAAK,AAAD,MAAO,IAAI,IAAIF,yBAAyB,KAAK,IAAIA,uBAAuB,CAAC,AAAD,IAAK;QAC7I,MAAMG,sBAAsB,EAAEd,cAAce,YAAY;QACxD,MAAMC,oBAAMC,OAAMC,SAAS;QAC3B,MAAMC,eAAe;YACjB1B,OAAOK,cAAcL,KAAK;YAC1B2B,kBAAkB,IAAK,CAAA;oBACf,GAAGtB,aAAa;oBAChB,cAAcc;oBACd,iBAAiBE;oBACjB,gBAAgBd,cAAce,YAAY;oBAC1CN;oBACA,wEAAwE;oBACxEO,KAAKG,aAAaJ,YAAY,GAAG,IAAIC,MAAMN,SAAS;gBACxD,CAAA;YACJM;YACAH,OAAOD;YACPf;YACAkB,cAAc;YACdpB,OAAO,CAAC;QACZ;QACAJ,cAAc8B,GAAG,CAACF,aAAa1B,KAAK,EAAE0B;QACtCzB,MAAM4B,IAAI,CAACH;IACf;IACA,MAAMI,gBAAgB;QAClBlC;QACAmC,MAAM9B,MAAME,MAAM;QAClB6B,YAAY,CAAC9B,QAAQD,KAAK,CAACC,MAAM;QACjCM,KAAK,CAACyB,MAAMnC,cAAcU,GAAG,CAACyB;QAC9BL,KAAK,CAACK,KAAKjC,QAAQF,cAAc8B,GAAG,CAACK,KAAKjC;IAC9C;IACA,OAAO8B;AACX;AACO,MAAMrC,iBAAiB;AAC9B,SAASI,yBAAyB;IAC9B,OAAO;QACH0B,KAAK;YACDW,SAAS,IAAI;QACjB;QACAlC,OAAOP;QACPW,aAAaa;QACbU,kBAAkB,IAAI;YAClB,IAAIlB,QAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;gBACvC,sCAAsC;gBACtCC,QAAQC,KAAK,CAAC;YAClB,CAAC;YACD,OAAO;gBACHb,OAAOP;gBACP,gBAAgB,CAAC;gBACjB,cAAc,CAAC;gBACf,iBAAiB,CAAC;gBAClBuB,UAAU;YACd;QACJ;QACAM,cAAc;QACd,IAAIpB,SAAS;YACT,IAAIO,QAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;gBACvC,sCAAsC;gBACtCC,QAAQC,KAAK,CAAC;YAClB,CAAC;YACD,OAAO,CAAC;QACZ;QACAO,OAAO;IACX;AACJ;AAEO,UAAU1B,6BAA6ByC,SAAS,EAAEL,aAAa,EAAE;IACpE,IAAI,IAAI5B,QAAQ,GAAGkC,eAAe,GAAGlC,QAAQ4B,cAAcC,IAAI,EAAE7B,QAAQ;QACrE,MAAMmC,OAAOP,cAAcE,UAAU,CAAC9B;QACtC,IAAIoC,cAAcD,MAAMF,WAAWL,gBAAgB;YAC/CO,KAAKnC,KAAK,GAAGkC;YACb,MAAMC;QACV,OAAO;YACH,0FAA0F;YAC1FnC,SAASmC,KAAKf,YAAY;QAC9B,CAAC;IACL;AACJ;AACA,SAASgB,cAAcD,IAAI,EAAEF,SAAS,EAAEL,aAAa,EAAE;IACnD,IAAIO,KAAKjB,KAAK,KAAK,GAAG;QAClB,OAAO,IAAI;IACf,CAAC;IACD,MAAMiB,KAAKjC,WAAW,IAAIiC,KAAKjC,WAAW,KAAK0B,cAAclC,IAAI,CAACI,KAAK,CAAC;QACpE,IAAI,CAACmC,UAAUI,GAAG,CAACF,KAAKjC,WAAW,GAAG;YAClC,OAAO,KAAK;QAChB,CAAC;QACD,MAAMoC,SAASV,cAActB,GAAG,CAAC6B,KAAKjC,WAAW;QACjD,IAAI,CAACoC,QAAQ;YACT,OAAO,KAAK;QAChB,CAAC;QACDH,OAAOG;IACX;IACA,OAAO,IAAI;AACf"}